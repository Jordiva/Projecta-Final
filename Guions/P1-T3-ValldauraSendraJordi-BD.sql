


DROP TABLE PAIS CASCADE CONSTRAINTS;
DROP TABLE ESTIL CASCADE CONSTRAINTS;
DROP TABLE ARTISTA CASCADE CONSTRAINTS;
DROP TABLE ART_GRUP CASCADE CONSTRAINTS;
DROP TABLE ART_IND CASCADE CONSTRAINTS;
DROP TABLE H_GRUP CASCADE CONSTRAINTS;
DROP TABLE CATALEG CASCADE CONSTRAINTS;
DROP TABLE CANÇO CASCADE CONSTRAINTS;
DROP TABLE AUTORIA CASCADE CONSTRAINTS;
DROP TABLE ALBUM CASCADE CONSTRAINTS;
DROP TABLE ALBUM_CONTINGUT CASCADE CONSTRAINTS;
DROP TABLE LLISTA CASCADE CONSTRAINTS;
DROP TABLE LLISTA_CONTINGUT CASCADE CONSTRAINTS;
DROP TABLE CLIENT CASCADE CONSTRAINTS;
DROP TABLE REPRODUCIO CASCADE CONSTRAINTS;




CREATE TABLE PAIS(
PAIS_ISO VARCHAR2(3) CONSTRAINT PK_PAIS PRIMARY KEY,
PAIS_NOM VARCHAR2(100) CONSTRAINT UN_PAIS_NOM UNIQUE
);

CREATE TABLE ESTIL(
EST_ID NUMBER(3) GENERATED ALWAYS AS IDENTITY 
                 CONSTRAINT PK_ESTILL PRIMARY KEY,
EST_NOM VARCHAR2(20) CONSTRAINT UN_EST_NOM UNIQUE
);

CREATE TABLE ARTISTA(
ART_ID NUMBER(3) GENERATED ALWAYS AS IDENTITY CONSTRAINT PK_ARTISTA PRIMARY KEY,
ART_NOM VARCHAR2(20) CONSTRAINT UN_ARTISTA_NOM UNIQUE,
ART_TIPUS CHAR(1) CONSTRAINT CK_ARTISTA_TIPUS CHECK (ART_TIPUS = 'I'OR ART_TIPUS = 'G')
);

CREATE TABLE ART_GRUP(
ARTG_ID NUMBER(3) CONSTRAINT PK_ART_GRUP PRIMARY KEY ,
ARTG_DATA_CREACIO DATE,
    
    CONSTRAINT FK_ART_GRUP FOREIGN KEY (ARTG_ID) REFERENCES ARTISTA (ART_ID)
);

CREATE TABLE ART_IND(
ARTI_ID NUMBER(3) CONSTRAINT PK_ART_IND PRIMARY KEY,
ARTI_DATA_NAIXAMENT DATE,
ARTI_NACIONALITAT VARCHAR2(3),

      CONSTRAINT FK_ARTI_ID FOREIGN KEY (ARTI_ID) REFERENCES ARTISTA (ART_ID),
      CONSTRAINT FK_ART_IND_NACIONLITAT FOREIGN KEY (ARTI_NACIONALITAT) REFERENCES PAIS (PAIS_ISO)
);

CREATE TABLE H_GRUP(
HG_ID_ARTGRU NUMBER(3),
HG_ID_ARTIND NUMBER(3),
HG_DATA_INICI DATE ,
HG_DATA_FINAL DATE NULL,
            PRIMARY KEY (HG_ID_ARTGRU,HG_ID_ARTIND,HG_DATA_INICI),
            CONSTRAINT FK_H_GRUP_ARTGRU FOREIGN KEY (HG_ID_ARTGRU) REFERENCES ART_GRUP (ARTG_ID),
            CONSTRAINT FK_H_GRUP_ARTIND FOREIGN KEY (HG_ID_ARTIND) REFERENCES ART_IND (ARTI_ID)
  
);

 
CREATE TABLE CATALEG( --CATALEG
CAT_ID NUMBER(3) GENERATED ALWAYS AS IDENTITY
                  CONSTRAINT PK_CATALEG PRIMARY KEY,
CAT_TITOL VARCHAR2(50) CONSTRAINT NN_CATALEG_TITOL NOT NULL,
CAT_ACTIU CHAR(1),
CAT_ESTIL NUMBER(3) ,
CAT_TIPUS CHAR(1) CONSTRAINT CK_CATALEG_TIPUS CHECK (CAT_TIPUS = 'C' OR CAT_TIPUS = 'A' OR CAT_TIPUS = 'L'),

          CONSTRAINT FK_CATALEG_ESTIL FOREIGN KEY (CAT_ESTIL) REFERENCES ESTIL (EST_ID)
        
);

CREATE TABLE CANÇO(
CAN_ID NUMBER(3) CONSTRAINT PK_CANÇO_ID PRIMARY KEY ,
CAN_ANY_CREACIO DATE,
CAN_INTERPRET NUMBER(3),
CAN_DURADA NUMBER(3) CONSTRAINT CK_CAN_DURADA CHECK(CAN_DURADA >0) ,

      CONSTRAINT FK_CANÇO_ID FOREIGN KEY (CAN_ID) REFERENCES CATALEG (CAT_ID),
	  CONSTRAINT FK_CANÇO_INTERPRET FOREIGN KEY (CAN_INTERPRET) REFERENCES  ARTISTA (ART_ID)
);



CREATE TABLE AUTORIA(
AUT_ID_CANÇO NUMBER(3),
AUT_ARTIND NUMBER(3), 
PRIMARY KEY (AUT_ID_CANÇO,AUT_ARTIND),

  CONSTRAINT FK_AUTORIA_ID_CANÇO FOREIGN KEY (AUT_ID_CANÇO) REFERENCES CANÇO (CAN_ID),
  CONSTRAINT FK_AUTORIA_ARTIND FOREIGN KEY (AUT_ARTIND) REFERENCES ART_IND (ARTI_ID)
);


CREATE TABLE ALBUM (
ALB_ID NUMBER(3) CONSTRAINT PK_ALBUM_ID PRIMARY KEY ,
ALB_ANY_CREACIO DATE,
ALB_DURADA NUMBER(3) CONSTRAINT CK_ALB_DURADA CHECK(ALB_DURADA >=0) ,
    CONSTRAINT FK_ALBUM_ID FOREIGN KEY (ALB_ID) REFERENCES CATALEG (CAT_ID)
);



CREATE TABLE ALBUM_CONTINGUT(
ALCO_ID_ALBUM NUMBER(3),
ALCO_ID_CANÇO NUMBER(3),
ALCO_POS NUMBER(2) GENERATED ALWAYS AS IDENTITY 
					CONSTRAINT CK_ALBUM_CONTINGUT_POS CHECK (ALCO_POS >0),
	UNIQUE(ALCO_ID_ALBUM,ALCO_POS),
    PRIMARY KEY (ALCO_ID_ALBUM,ALCO_ID_CANÇO),
    CONSTRAINT FK_ALBUM_CONTINGUT_ID_ALBUM FOREIGN KEY (ALCO_ID_ALBUM) REFERENCES  ALBUM  (ALB_ID),
    CONSTRAINT FK_ALBUM_CONTINGUT_ID_CANÇO FOREIGN KEY  (ALCO_ID_CANÇO) REFERENCES CATALEG (CAT_ID)

);

CREATE TABLE LLISTA(

LLI_ID NUMBER(3) CONSTRAINT PK_LLISTA_ID PRIMARY KEY,
LLI_DURADA NUMBER(3) CONSTRAINT CK_LLI_DURADA CHECK(LLI_DURADA >=0),	
        CONSTRAINT FK_LLISTA_ID FOREIGN KEY (LLI_ID) REFERENCES CATALEG (CAT_ID)
);


CREATE TABLE LLISTA_CONTINGUT(
LLCON_ID_LLISTA NUMBER(3) ,
LLCON_ID_CATALAG NUMBER(3)  ,
LLCON_POS NUMBER(2) GENERATED ALWAYS AS IDENTITY
				   CONSTRAINT CK_LLISTA_CONTINGUT_POS CHECK (LLCON_POS >0),
           UNIQUE (LLCON_ID_LLISTA,LLCON_POS),
           PRIMARY KEY (LLCON_ID_LLISTA,LLCON_ID_CATALAG),
           CONSTRAINT FK_LLISTA_CONTINGUT_ID_LLISTA FOREIGN KEY (LLCON_ID_LLISTA) REFERENCES LLISTA (LLI_ID),
           CONSTRAINT FK_LLISTA_CONTINGUT_ID_CATALAG FOREIGN KEY (LLCON_ID_CATALAG) REFERENCES CATALEG (CAT_ID)
);


CREATE TABLE CLIENT (

CLI_ID NUMBER(3) generated by default on null as identity
                 CONSTRAINT PK_CLIENT PRIMARY KEY  
                 constraint figura_id_ck check (CLI_ID>=0),
CLI_EMAIL VARCHAR2(100) CONSTRAINT NN_EMAIL NOT NULL,
CLI_NOM VARCHAR2(20) CONSTRAINT NN_NOM NOT NULL,
CLI_COGNOM VARCHAR2(20) CONSTRAINT NN_COGNOM NOT NULL,
CLI_DATA_NAIX DATE CONSTRAINT NN_DATA_NAIX  NOT NULL,
CLI_C_POSTAL NUMBER(10) CONSTRAINT NN_C_POSTAL NOT NULL,
CLI_DOM1 VARCHAR2(100) CONSTRAINT NN_DOM1 NOT NULL,
CLI_DOM2 VARCHAR2(100),
CLI_POBLACIO VARCHAR2(50) CONSTRAINT NN_POBLACIO NOT NULL,
CLI_PAIS VARCHAR2(3),
CONSTRAINT FK_CLIENT_PAIS FOREIGN KEY (CLI_PAIS) REFERENCES PAIS (PAIS_ISO)

);



CREATE TABLE REPRODUCIO(
REP_ID_CLIENT NUMBER(3),
REP_MOMENT_TEMPORAL DATE,
REP_ID_CATALAG NUMBER(3),
            
            PRIMARY KEY (REP_ID_CLIENT,REP_ID_CATALAG),
           CONSTRAINT FK_REPRODUCIO_ID_CLIENT FOREIGN KEY (REP_ID_CLIENT) REFERENCES CLIENT (CLI_ID),
           CONSTRAINT FK_REPRODUCIO_ID_CATALAG FOREIGN KEY (REP_ID_CATALAG) REFERENCES CATALEG (CAT_ID)
);


